language: ruby

rvm:
  - 2.4.4
  - 2.5.1
  - 2.6.3

notifications:
  email:
    on_success: change
    on_failure: always

gemfile:
  - Gemfile
  - Gemfile.aws-sdk-core-v2

env:
  - SPEC_ALL=true RAKE_TASK=spec

jobs:
  include:
  - rvm: 2.2
    gemfile: gemfiles/rails_4_2.gemfile
    env: RAKE_TASK=rails_specs
  - rvm: 2.5
    gemfile: gemfiles/rails_5_2.gemfile
    env: RAKE_TASK=rails_specs
  - rvm: 2.6
    gemfile: gemfiles/rails_6_0.gemfile
    env: RAKE_TASK=rails_specs
  - rvm: 3.0
    gemfile: gemfiles/rails_6_1.gemfile
    env: RAKE_TASK=rails_specs

script: bundle exec rake "$RAKE_TASK"

before_install:
  - gem install bundler -v '< 2'

after_success:
  - bundle exec codeclimate-test-reporter

addons:
  code_climate:
    repo_token: 7709fd21981bb9d2658647a66d959415a1029a83f1c199573828797944f26c52
